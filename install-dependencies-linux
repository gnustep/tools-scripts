#!/bin/bash

install_debian()
{
    echo "NOTE: Make sure you have done apt-get update and apt-get upgrade prior to running this script."
    echo "Installing Debian/Ubuntu dependencies"
    echo "-------"

    sudo apt update
    sudo apt upgrade

    sudo apt --yes install gobjc 
    sudo apt --yes install gobjc++
    sudo apt --yes install clang
    sudo apt --yes install libjpeg-dev 
    sudo apt --yes install libtiff-dev 
    sudo apt --yes install libpng-dev 
    sudo apt --yes install libicns-dev
    sudo apt --yes install libmagickcore-dev
    sudo apt --yes install libxml2-dev 
    sudo apt --yes install libxslt-dev 
    sudo apt --yes install libgnutls-dev
    sudo apt --yes install libffi-dev 
    sudo apt --yes install libicu-dev 
    sudo apt --yes install libcairo2-dev
    sudo apt --yes install libxft-dev
    sudo apt --yes install libavahi-client-dev
    sudo apt --yes install flite-dev
    sudo apt --yes install libxt-dev
    sudo apt --yes install libportaudio-dev
    sudo apt --yes install wmaker
    sudo apt --yes install portaudio19-dev
    sudo apt --yes install make
    sudo apt --yes install cmake
    sudo apt --yes install gnutls-dev
    sudo apt --yes install libblocksruntime-dev
    sudo apt --yes install pocketsphinx
    sudo apt --yes install pocketsphinx-en-us
    sudo apt --yes install libpocketsphinx-dev
    sudo apt --yes install libsphinxbase-dev
    sudo apt --yes install sphinxbase-utils
    sudo apt --yes install sphinxtrain
    sudo apt --yes install libssl-dev
    sudo apt --yes install freeglut3-dev
    sudo apt --yes install libwayland-dev
    sudo apt --yes install libxkbcommon-dev
    sudo apt --yes install wayland-protocols
    
    echo "-------"
    echo "Done..."
}

install_redhat()
{
    echo "NOTE: Make sure you have done apt-get update and apt-get upgrade prior to running this script."
    echo "Installing RedHat/CentOS/etc dependencies"
    echo "-------"

    sudo yum update
    
    sudo yum -y install gcc 
    sudo yum -y install gcc-objc
    sudo yum -y install clang
    sudo yum -y install libjpeg-turbo-devel 
    sudo yum -y install libtiff-devel 
    sudo yum -y install libpng-devel
    sudo yum -y install libicns-devel
    sudo yum -y install ImageMagick-devel
    sudo yum -y install libxml2-devel
    sudo yum -y install libxslt-devel
    sudo yum -y install gnutls-devel
    sudo yum -y install libffi-devel
    sudo yum -y install libicu-devel
    sudo yum -y install cairo-devel
    sudo yum -y install libXft-devel
    sudo yum -y install avahi-devel
    sudo yum -y install flite-devel
    sudo yum -y install libXt-devel
#    sudo yum -y install libportaudio-devel
#    sudo yum -y install wmaker
#    sudo yum -y install portaudio19-dev
    sudo yum -y install make
    sudo yum -y install cmake
#    sudo yum -y install libblocksruntime-dev
#    sudo yum -y install pocketsphinx
#    sudo yum -y install pocketsphinx-en-us
#    sudo yum -y install libpocketsphinx-dev
#    sudo yum -y install libsphinxbase-dev
#    sudo yum -y install sphinxbase-utils
#    sudo yum -y install sphinxtrain
    sudo yum -y install openssl-devel
    sudo yum -y install gnutls-devel

    echo "-------"
    echo "Done..."
}

install_arch()
{
    echo "Installing Arch Linux dependencies"
    echo "-------"

    sudo pacman -Syu --noconfirm

    sudo pacman -S --needed --noconfirm gcc-objc
    sudo pacman -S --needed --noconfirm clang
    sudo pacman -S --needed --noconfirm libjpeg-turbo
    sudo pacman -S --needed --noconfirm libtiff
    sudo pacman -S --needed --noconfirm libpng
    sudo pacman -S --needed --noconfirm libicns
    sudo pacman -S --needed --noconfirm imagemagick
    sudo pacman -S --needed --noconfirm libxml2
    sudo pacman -S --needed --noconfirm libxslt
    sudo pacman -S --needed --noconfirm gnutls
    sudo pacman -S --needed --noconfirm libffi
    sudo pacman -S --needed --noconfirm icu
    sudo pacman -S --needed --noconfirm cairo
    sudo pacman -S --needed --noconfirm libxft
    sudo pacman -S --needed --noconfirm avahi
    sudo pacman -S --needed --noconfirm flite
    sudo pacman -S --needed --noconfirm libxt
    sudo pacman -S --needed --noconfirm portaudio
    sudo pacman -S --needed --noconfirm make
    sudo pacman -S --needed --noconfirm cmake
    sudo pacman -S --needed --noconfirm openssl
    sudo pacman -S --needed --noconfirm freeglut
    sudo pacman -S --needed --noconfirm giflib
    sudo pacman -S --needed --noconfirm libao

    cd /tmp && git clone https://github.com/mheily/blocks-runtime.git --depth=1
    cd /tmp/blocks-runtime.git && autoheader && libtoolize --force --copy && aclocal && autoconf && automake --add-missing --copy && ./configure --prefix=/usr && make && sudo make install

    if [ ! -f /etc/ld.so.conf.d/libc.conf ]; then
      echo -e "# libc default configuration\n/usr/local/lib" | sudo tee /etc/ld.so.conf.d/libc.conf > /dev/null
      sudo ldconfig
    fi

    echo "-------"
    echo "Done..."
}

get_system()
{
    if [ -e /etc/os-release ]; then
        . /etc/os-release
    fi
}

get_system
echo "You are using ${ID}"

which apt > /dev/null
if [ "$?" == "0" ]; then
    install_debian
else
    which yum
    if [ "$?" == "0" ]; then
	install_redhat
    else
        which pacman > /dev/null
        if [ "$?" == "0" ]; then
        install_arch
        else    
	        echo "Please report this to bugs-gnustep@gnu.org."
            echo "Your linux os ${ID} is currently unsupported."
        fi
    fi
fi

